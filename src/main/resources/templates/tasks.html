<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Мой список задач</title>
    <!-- Можно добавить CSS стили сюда или подключить внешний файл -->
    <style>
        body { font-family: sans-serif; }
        .task-list { list-style: none; padding: 0; }
        .task-item { border: 1px solid #ccc; margin-bottom: 10px; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .task-item.completed span { text-decoration: line-through; color: grey; }
        .task-actions form { display: inline-block; margin-left: 5px;}
        .add-form { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; }
        .messages div { padding: 10px; margin-bottom: 15px; border-radius: 4px; }
        .message { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

<h1>Список Задач</h1>

<!-- Отображение сообщений об успехе или ошибках -->
<div class="messages">
    <div th:if="${message}" th:text="${message}" class="message"></div>
    <div th:if="${error}" th:text="${error}" class="error"></div>
</div>


<!-- Форма для добавления новой задачи -->
<div class="add-form">
    <h2>Добавить новую задачу</h2>
    <!-- Используем th:action для указания URL обработки, th:object для связывания с объектом newTask из модели -->
    <form th:action="@{/add}" th:object="${newTask}" method="post">
        <input type="text" th:field="*{description}" placeholder="Описание задачи" required size="50"/>
        <!-- Поле completed пока не добавляем в форму, оно устанавливается в контроллере -->
        <button type="submit">Добавить</button>
    </form>
</div>


<!-- Список существующих задач -->
<h2>Текущие задачи</h2>
<ul class="task-list">
    <!-- Проверяем, есть ли задачи вообще -->
    <div th:if="${tasks.isEmpty()}">
        <p>У вас пока нет задач.</p>
    </div>

    <!-- Итерируемся по списку задач (переданному как "tasks" из контроллера) -->
    <li th:each="task : ${tasks}" th:classappend="${task.completed} ? 'completed' : ''" class="task-item">
        <span>
            <!-- Отображаем описание задачи -->
            <strong th:text="${taskStat.count}">1</strong>.
            <span th:text="${task.description}">Описание задачи...</span>
            <!-- Отображаем статус -->
            (<span th:text="${task.completed} ? 'Выполнено' : 'Не выполнено'">Статус</span>)
            <!-- Отображаем дату создания (форматируем ее) -->
            - <small th:text="${#temporals.format(task.createdAt, 'dd.MM.yyyy HH:mm')}">Дата</small>
        </span>
        <div class="task-actions">
            <!-- Форма для переключения статуса -->
            <form th:action="@{/toggle/{id}(id=${task.id})}" method="post">
                <button type="submit"
                        th:text="${task.completed} ? 'Отметить как невыполненное' : 'Отметить как выполненное'">
                    Переключить
                </button>
            </form>

            <!-- ССЫЛКА НА РЕДАКТИРОВАНИЕ -->
            <a th:href="@{/edit/{id}(id=${task.id})}" style="display: inline-block; margin-left: 5px; padding: 5px 10px; background-color: #ffc107; color: black; text-decoration: none; border-radius: 4px; font-size: 0.9em;">Редактировать</a>
            <!-- Мы используем простую ссылку (GET-запрос) для перехода на страницу редактирования -->
            <!-- Добавил немного inline-стилей для наглядности, лучше вынести в CSS -->

            <!-- Форма для удаления задачи -->
            <form th:action="@{/delete/{id}(id=${task.id})}" method="post"
                  onsubmit="return confirm('Вы уверены, что хотите удалить эту задачу?');">
                <button type="submit">Удалить</button>
            </form>
        </div>
    </li>
</ul>

</body>
</html>